<div class="main-container">
    <!-- Left Sidebar (Menu) -->
    <aside class="sidebar">
        <!-- Top Section -->
        <div class="sidebar-top">
            <div class="profile-section">
                <!-- User profile or other content goes here -->
                <img src="currentUserPhoto" alt="Profile" class="profile-image" (click)="toggleMenu()">
            </div>

            <!-- Pop-up menu -->
            <div class="profile-menu" *ngIf="isMenuVisible">
                <p>{{ currentUserName }}</p>
                <ul>
                    <li><a (click)="onClick()">Hồ sơ của bạn</a></li>
                    <li><a (click)="onClick()">Nhật ký hoạt động</a></li>
                    <li><a (click)="onClick()">Đăng xuất</a></li>
                </ul>
            </div>
            <div class="clickable" (click)="setActiveView('conversations')">
                <div class="img-container">
                    <img src="assets/chatbubble.png" alt="chat-icon">
                </div>
            </div>
            <div class="clickable" (click)="setActiveView('contacts')">
                <div class="img-container">
                    <img src="assets/contact-book.png" alt="chat-icon">
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="sidebar-bottom">
            <div class="clickable" (click)="onClick()">
                <div class="img-container">
                    <img src="assets/cloud.png" alt="chat-icon">
                </div>
            </div>
            <div class="clickable" (click)="onClick()">
                <div class="img-container">
                    <img src="assets/briefcase.png" alt="chat-icon">
                </div>
            </div>
            <div class="clickable" (click)="onClick()">
                <div class="img-container">
                    <img src="assets/settings.png" alt="chat-icon">
                </div>
            </div>
        </div>
    </aside>

    <!-- Middle Panel (Chat List) -->
    <section class="chat-list-panel">

        <div id="contact-search-grid" class="grid-setting" style="grid-template-columns: auto 32px 32px;">
            <div class="group-search-item">
                <img src="assets/search.png" alt="search-icon" class="search-container click">
                <input type="text" placeholder="Tìm số điện thoại hoặc tên" class="search-bar-input"
                    [(ngModel)]="searchInput" (keyup.enter)="onSearch()" minlength="1" pattern="\d*"
                    [matAutocomplete]="users">
                <mat-autocomplete #users="matAutocomplete" (optionSelected)="onUserSelected($event.option.value)">
                    <mat-option *ngFor="let user of searchResults" [value]="user">
                        {{ user.participantName }}
                    </mat-option>
                </mat-autocomplete>
            </div>
        </div>



        <!-- Display conversation list -->
        <div *ngIf="activeView === 'conversations'">

            <mat-tab-group animationDuration="0ms" class="tabs">
                <mat-tab>
                    <ng-template mat-tab-label>
                        <span class="custom-tab-label" (click)="resetView()">Tất cả</span>
                    </ng-template>

                    <ul class="chat-list">
                        <li *ngFor="let conversation of conversationsList" class="chat-item"
                            (click)="selectUser({ id: conversation.id, userName: getParticipantNames(conversation) })">
                            <div class="chat-info">
                                <!-- Avatar placeholder (you can replace this with actual participant images if available) -->
                                <img src="assets/letter-z.png" alt="User Avatar" class="header-avatar">
                                <div>
                                    <!-- Dynamically display participant names for each conversation -->
                                    <p class="chat-name">
                                        {{ getParticipantNames(conversation) }}
                                    </p>
                                    <!-- Placeholder for last message -->
                                    <p class="last-message">
                                        Bạn: {{ conversation.lastMessage?.content || '...' }}
                                    </p>
                                </div>
                            </div>
                            <!-- Display formatted last message time -->
                            <span class="chat-time">
                                {{ conversation.lastMessageTime | date: 'dd/MM' }}
                            </span>
                        </li>
                    </ul>
                </mat-tab>

                <mat-tab>
                    <ng-template mat-tab-label>
                        <span class="custom-tab-label">Chưa đọc</span>
                    </ng-template>
                    Không có nội dung chưa đọc
                </mat-tab>
            </mat-tab-group>
        </div>

        <div *ngIf="activeView === 'contacts'">
            <ul class="chat-list">
                <li *ngFor="let content of contactBox" class="chat-item">
                    <div class="chat-info">
                        <img src="assets/letter-z.png" alt="User Avatar" class="header-avatar">
                        <div>
                            <p class="chat-name">{{content}}</p>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </section>

    <!-- Right Panel (Main Content) -->
    <main class="content">
        <!-- Default Message When No Conversation is Selected -->
        <div *ngIf="!selectedUser" class="welcome-page">
            <img src="assets/Logo_Zalo.png" alt="Welcome Image" class="welcome-image">
            <h2>Chào mừng đến với Zalo PC!</h2>
            <p>Khám phá những tiện ích hỗ trợ làm việc và trò chuyện cùng<br>
                người thân, bạn bè được tối ưu hóa cho máy tính của bạn.</p>
        </div>

        <!-- Conversation Box When a User is Selected -->
        <div *ngIf="selectedUser">
            <div class="conversation-header">
                <div class="conversation-header-left">
                    <img src="assets/letter-z.png" alt="User Avatar" class="header-avatar">
                    <span class="header-username">{{ selectedUser.userName }}</span>
                </div>
                <div class="conversation-header-right">
                    <button class="header-btn" title="Add User">
                        <img src="assets/people.png" alt="Add User">
                    </button>
                    <button class="header-btn" title="Search in Conversation">
                        <img src="assets/search.png" alt="Search">
                    </button>
                    <button class="header-btn" title="Video Call">
                        <img src="assets/camera.png" alt="Video Call">
                    </button>
                </div>
            </div>

            <!-- Conversation Messages -->
            <div class="chatting-part">
                <div *ngIf="selectedUser">
                    <div *ngFor="let message of getConversationMessages()"
                        [ngClass]="{'message': true, 'you': message.sender === currentUserId, 'sender': message.sender !== currentUserId}">

                        <div class="message-content" [innerHTML]="message.content"></div>

                        <ng-container *ngIf="isImage(message.content)">
                            <img [src]="getImageSrc(message.content)" alt="Image Message" class="message-image">
                        </ng-container>
                    </div>
                </div>
            </div>

            <!-- Chat Input Features -->
            <div class="features-part">
                <!-- Image Upload -->
                <button class="feature-btn" title="Send Image" (click)="triggerFileInput('image')">
                    <img src="assets/image.png" alt="Send Image">
                </button>
                <!-- <input type="file" #imageInput accept="image/*" (change)="handleFileInput($event, 'image')" hidden> -->

                <!-- Video Upload -->
                <button class="feature-btn" title="Send Video" (click)="triggerFileInput('video')">
                    <img src="assets/video.png" alt="Send Video">
                </button>
                <!-- <input type="file" #videoInput accept="video/*" (change)="handleFileInput($event, 'video')" hidden> -->

                <!-- Document Upload -->
                <button class="feature-btn" title="Send File" (click)="triggerFileInput('document')">
                    <img src="assets/attach.png" alt="Send File">
                </button>
                <!-- <input type="file" #documentInput accept=".pdf,.doc,.docx,.txt"
                    (change)="handleFileInput($event, 'document')" hidden> -->
            </div>

            <!-- Typing Input -->
            <div class="typing-part">
                <input type="text" placeholder="Nhập tin nhắn ở đây..." class="message-input" [(ngModel)]="messageText"
                    (keyup)="$event.keyCode === 13 && sendMessage()">
                <button class="icon-btn">
                    <img src="assets/smile.png" alt="Select Icon">
                </button>
                <button class="like-btn">
                    <img src="assets/like.png" alt="Like">
                </button>
            </div>
        </div>
    </main>
</div>